/**
 * Created by Maana on 1/17/2016.
 */

var authentication = require('../config/authentication');
var balance = require('../services/checkbalance');
var message = require('../services/sendMessage');
module.exports = function(app) {


//=========================================================================================================
//CHECK BALANCE ROUTE=========================================================================================
//=========================================================================================================

    app.get('/checkbalance', function (req, res) {
        // render the page and pass in any flash data if it exists
        res.send('sadsad');

    });


//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

//=========================================================================================================
//LOGOUT ROUTE=========================================================================================
//=========================================================================================================
    app.get('/logout', authentication.isAuthorized, function (req, res) {
        // render the page and pass in any flash data if it exists
        req.session.reset();
        res.redirect('/login');

    });
//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

//=========================================================================================================
//MESSAGE ROUTE=========================================================================================
//=========================================================================================================
    app.get('/message', authentication.isAuthorized, function (req, res) {
        // render the page and pass in any flash data if it exists

        res.render('message.ejs', { message: req.flash('loginMessage') });
    });
    app.post('/message', authentication.isAuthorized,message.send, function (req, res) {
        // render the page and pass in any flash data if it exists

        res.render('message.ejs', { message: req.flash('messagesent') });
    });
//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

//=========================================================================================================
//LOGIN ROUTE=========================================================================================
//=========================================================================================================

    app.get('/login', function (req, res) {
        // render the page and pass in any flash data if it exists

        res.render('login.ejs', { message: req.flash('loginMessage') });
    });
    app.post('/login', authentication.authorizing, function (req, res) {

        res.redirect('/message');
    });

//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

    //=========================================================================================================
//PASSWORD CHANGE ROUTE=========================================================================================
//=========================================================================================================
    app.get('/passwordchange', authentication.isAuthorized,balance.getBalance, function (req, res) {
        // render the page and pass in any flash data if it exists
        res.render('passwordchange.ejs', { message: req.flash('passwordChangeMessage'),balance:req.flash('balance') });
    });
    app.post('/passwordchange', authentication.isAuthorized,authentication.updatePassword,balance.getBalance, function (req, res) {
        // render the page and pass in any flash data if it exists

//        console.log( req.flash('passwordChangeMessage'));
        res.render('passwordchange.ejs', { message: req.flash('passwordChangeMessage') ,balance:req.flash('balance') });
    });
//=========================================================================================================
//=========================================================================================================
//=========================================================================================================
}


