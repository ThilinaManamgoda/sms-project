/**
 * Created by Maana on 1/17/2016.
 */

var authentication = require('../config/authentication');
module.exports = function(app) {


//=========================================================================================================
//TXT REPLY ROUTE=========================================================================================
//=========================================================================================================




//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

//=========================================================================================================
//LOGOUT ROUTE=========================================================================================
//=========================================================================================================
    app.get('/logout', authentication.isAuthorized, function (req, res) {
        // render the page and pass in any flash data if it exists
        req.session.reset();
        res.redirect('/login');

    });
//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

//=========================================================================================================
//MESSAGE ROUTE=========================================================================================
//=========================================================================================================
    app.get('/message', authentication.isAuthorized, function (req, res) {
        // render the page and pass in any flash data if it exists

        res.render('message.ejs', { message: req.flash('loginMessage') });
    });
//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

//=========================================================================================================
//LOGIN ROUTE=========================================================================================
//=========================================================================================================

    app.get('/login', function (req, res) {
        // render the page and pass in any flash data if it exists

        res.render('login.ejs', { message: req.flash('loginMessage') });
    });
    app.post('/login', authentication.authorizing, function (req, res) {

        res.redirect('/message');
    });

//=========================================================================================================
//=========================================================================================================
//=========================================================================================================

    //=========================================================================================================
//PASSWORD CHANGE ROUTE=========================================================================================
//=========================================================================================================
    app.get('/passwordchange', authentication.isAuthorized, function (req, res) {
        // render the page and pass in any flash data if it exists
        res.render('passwordchange.ejs', { message: req.flash('passwordChangeMessage') });
    });
    app.post('/passwordchange', authentication.isAuthorized,authentication.updatePassword, function (req, res) {
        // render the page and pass in any flash data if it exists

//        console.log( req.flash('passwordChangeMessage'));
        res.render('passwordchange.ejs', { message: req.flash('passwordChangeMessage') });
    });
//=========================================================================================================
//=========================================================================================================
//=========================================================================================================
}


